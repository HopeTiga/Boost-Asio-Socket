# AsioCoroutine

## é¡¹ç›®ç®€ä»‹
AsioCoroutine æ˜¯ä¸€ä¸ªåŸºäº C++20 åç¨‹å’Œ Boost.Asio æ„å»ºçš„é«˜æ€§èƒ½å¼‚æ­¥ç½‘ç»œæœåŠ¡å™¨æ¡†æ¶ã€‚è¯¥é¡¹ç›®é‡‡ç”¨ç°ä»£ C++ è®¾è®¡ç†å¿µï¼Œæ”¯æŒåŠ¨æ€çº¿ç¨‹æ± ã€ç³»ç»Ÿç›‘æ§ã€å†…å­˜ä¼˜åŒ–ç­‰ç‰¹æ€§ï¼Œé€‚ç”¨äºé«˜å¹¶å‘ç½‘ç»œåº”ç”¨å¼€å‘ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸš€ é«˜æ€§èƒ½å¼‚æ­¥æ¶æ„
- **C++20 åç¨‹**ï¼šåŸºäº `std::coroutine` å®ç°æ— æ ˆåç¨‹ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€
- **Boost.Asio**ï¼šå¼‚æ­¥ I/O æ“ä½œï¼Œæ”¯æŒé«˜å¹¶å‘è¿æ¥
- **åŠ¨æ€ I/O çº¿ç¨‹æ± **ï¼šæ ¹æ®ç³»ç»Ÿè´Ÿè½½è‡ªåŠ¨è°ƒæ•´ I/O çº¿ç¨‹æ•°é‡
- **æ— é”æ¶ˆæ¯é˜Ÿåˆ—**ï¼šä½¿ç”¨ `moodycamel::ConcurrentQueue` å®ç°é«˜æ•ˆæ¶ˆæ¯ä¼ é€’

### ğŸ“Š æ™ºèƒ½ç³»ç»Ÿç›‘æ§
- **å®æ—¶ç³»ç»Ÿç›‘æ§**ï¼šCPUã€å†…å­˜ã€ç½‘ç»œ I/O å‹åŠ›ç›‘æµ‹
- **è‡ªé€‚åº”çº¿ç¨‹ç®¡ç†**ï¼šæ ¹æ®è´Ÿè½½åŠ¨æ€å¢å‡å¤„ç†çº¿ç¨‹
- **æ€§èƒ½æŒ‡æ ‡æ”¶é›†**ï¼šæ¶ˆæ¯å¤„ç†æ—¶é—´ã€é˜Ÿåˆ—å‹åŠ›ç­‰å…³é”®æŒ‡æ ‡

### ğŸ”§ å†…å­˜ä¼˜åŒ–
- **AVX2 ä¼˜åŒ–å†…å­˜æ‹·è´**ï¼šä½¿ç”¨ SIMD æŒ‡ä»¤é›†åŠ é€Ÿæ•°æ®ä¼ è¾“
- **æ™ºèƒ½å†…å­˜ç®¡ç†**ï¼šæ”¯æŒå†…å­˜æ± å’Œæ™®é€šåˆ†é…ä¸¤ç§æ–¹å¼
- **é›¶æ‹·è´ä¼˜åŒ–**ï¼šå‡å°‘ä¸å¿…è¦çš„æ•°æ®å¤åˆ¶

### ğŸ›¡ï¸ é«˜å¯é æ€§
- **å¼‚å¸¸å®‰å…¨**ï¼šå…¨é¢çš„å¼‚å¸¸å¤„ç†å’Œèµ„æºç®¡ç†
- **ä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šå®‰å…¨çš„è¿æ¥å»ºç«‹å’Œæ–­å¼€
- **å†…å­˜æ³„æ¼é˜²æŠ¤**ï¼šRAII å’Œæ™ºèƒ½æŒ‡é’ˆç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   main.cpp      â”‚â”€â”€â”€â–¶â”‚   CServer        â”‚â”€â”€â”€â–¶â”‚   CSession      â”‚
â”‚   (å…¥å£ç¨‹åº)     â”‚     â”‚   (æœåŠ¡å™¨æ ¸å¿ƒ)   â”‚    â”‚   (ä¼šè¯ç®¡ç†)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                        â”‚
                                â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AsioProactors   â”‚â—€â”€â”€â”€â”‚SystemMonitor     â”‚    â”‚ MessageNodes    â”‚
â”‚ (I/Oçº¿ç¨‹æ± )     â”‚     â”‚ (ç³»ç»Ÿç›‘æ§)        â”‚    â”‚ (æ¶ˆæ¯èŠ‚ç‚¹)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                        â”‚
         â–¼                       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚boost::asio      â”‚    â”‚AdvancedSystem    â”‚    â”‚ LogicSystem     â”‚
â”‚(å¼‚æ­¥I/O)        â”‚    â”‚ Monitor          â”‚    â”‚ (é€»è¾‘å¤„ç†)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ (é«˜çº§ç›‘æ§)       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                                                        â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚SystemCoroutine  â”‚
                                               â”‚(åç¨‹è°ƒåº¦)       â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸»è¦æ¨¡å—

### æ ¸å¿ƒç½‘ç»œå±‚
- **`CServer`**: æœåŠ¡å™¨ä¸»ç±»ï¼Œè´Ÿè´£è¿æ¥æ¥å—å’Œä¼šè¯ç®¡ç†
- **`CSession`**: ä¼šè¯ç±»ï¼Œå¤„ç†å•ä¸ªå®¢æˆ·ç«¯è¿æ¥çš„æ¶ˆæ¯æ”¶å‘
- **`AsioProactors`**: I/O çº¿ç¨‹æ± ï¼Œæ ¹æ®è´Ÿè½½åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ•°é‡

### æ¶ˆæ¯å¤„ç†å±‚
- **`LogicSystem`**: æ¶ˆæ¯å¤„ç†ç³»ç»Ÿï¼Œæ”¯æŒåŠ¨æ€çº¿ç¨‹æ± å’Œåç¨‹è°ƒåº¦
- **`MessageNodes`**: æ¶ˆæ¯èŠ‚ç‚¹å®šä¹‰ï¼Œæ”¯æŒå¤šç§å†…å­˜åˆ†é…ç­–ç•¥
- **`SystemCoroutine`**: åç¨‹å°è£…ï¼Œæä¾›å¼‚æ­¥ä»»åŠ¡è°ƒåº¦

### ç³»ç»Ÿç›‘æ§å±‚
- **`AdvancedSystemMonitor`**: è·¨å¹³å°ç³»ç»Ÿç›‘æ§ï¼Œæ”¯æŒ Windows/Linux/macOS
- **`MessagePressureMetrics`**: æ¶ˆæ¯å‹åŠ›æŒ‡æ ‡æ”¶é›†å’Œåˆ†æ

### å·¥å…·å±‚
- **`Utils`**: æ—¥å¿—ç³»ç»Ÿå’Œé€šç”¨å·¥å…·å‡½æ•°
- **`FastMemcpy_Avx`**: AVX2 ä¼˜åŒ–çš„å†…å­˜æ‹·è´å®ç°
- **`concurrentqueue`**: é«˜æ€§èƒ½æ— é”å¹¶å‘é˜Ÿåˆ—

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- **ç¼–è¯‘å™¨**: æ”¯æŒ C++20 çš„ç¼–è¯‘å™¨ (GCC 10+, Clang 12+, MSVC 2022+)
- **ä¾èµ–åº“**: 
  - Boost 1.75+ (asio, system, uuid)
  - CMake 3.15+ (å¯é€‰)


### é…ç½®æ–‡ä»¶
åˆ›å»º `config.ini` æ–‡ä»¶ï¼š
```ini
[SelfServer]
Host=0.0.0.0
Port=8080

[Chatservers]
Name=server1,server2,server3
```

### è¿è¡Œ
```bash
./AsioCoroutine
```

## æ€§èƒ½ç‰¹æ€§

### å¹¶å‘èƒ½åŠ›
- **è¿æ¥æ•°**: æ”¯æŒæ•°ä¸‡å¹¶å‘è¿æ¥
- **ååé‡**: ä¼˜åŒ–çš„æ¶ˆæ¯å¤„ç†æµæ°´çº¿
- **å»¶è¿Ÿ**: å¾®ç§’çº§æ¶ˆæ¯å¤„ç†å»¶è¿Ÿ

### å†…å­˜ä¼˜åŒ–
- **SIMD åŠ é€Ÿ**: AVX2 æŒ‡ä»¤é›†ä¼˜åŒ–å†…å­˜æ‹·è´ï¼Œæå‡ 50% æ€§èƒ½
- **å†…å­˜æ± **: å‡å°‘é¢‘ç¹çš„å†…å­˜åˆ†é…/é‡Šæ”¾
- **æ™ºèƒ½ç¼“å­˜**: æ ¹æ®æ¶ˆæ¯å¤§å°é€‰æ‹©æœ€ä¼˜æ‹·è´ç­–ç•¥

### è‡ªé€‚åº”è°ƒä¼˜
- **åŠ¨æ€çº¿ç¨‹æ± **: æ ¹æ® CPU/å†…å­˜å‹åŠ›è‡ªåŠ¨è°ƒæ•´çº¿ç¨‹æ•°
- **è´Ÿè½½å‡è¡¡**: æ¶ˆæ¯åœ¨å¤šä¸ªå¤„ç†çº¿ç¨‹é—´æ™ºèƒ½åˆ†å‘
- **èƒŒå‹æ§åˆ¶**: é˜²æ­¢æ¶ˆæ¯é˜Ÿåˆ—è¿‡è½½

## API ç¤ºä¾‹

### æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨
```cpp
// åœ¨ LogicSystem ä¸­æ³¨å†Œæ¶ˆæ¯å›è°ƒ
callBackFunctions[1001] = std::bind(&LogicSystem::handleMessage, 
    this, std::placeholders::_1, std::placeholders::_2, std::placeholders::_3);
```

### å‘é€æ¶ˆæ¯
```cpp
// é€šè¿‡ä¼šè¯å‘é€æ¶ˆæ¯
session->writeAsync("Hello, Client!", 1001);
```

### ç³»ç»Ÿç›‘æ§
```cpp
// è·å–ç³»ç»Ÿè´Ÿè½½
double cpuUsage = AdvancedSystemMonitor::getInstance()->getCPUUsage();
double memPressure = AdvancedSystemMonitor::getInstance()->getMemoryPressure();
```

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„æ¶ˆæ¯å¤„ç†å™¨
1. åœ¨ `LogicSystem::registerCallBackFunction()` ä¸­æ³¨å†Œæ–°çš„æ¶ˆæ¯ ID
2. å®ç°å¯¹åº”çš„å¤„ç†å‡½æ•°
3. é‡æ–°ç¼–è¯‘å³å¯

### è‡ªå®šä¹‰ç³»ç»Ÿç›‘æ§æŒ‡æ ‡
1. ç»§æ‰¿ `AdvancedSystemMonitor` ç±»
2. å®ç°ç‰¹å®šçš„ç›‘æ§é€»è¾‘
3. åœ¨é…ç½®ä¸­å¯ç”¨æ–°çš„ç›‘æ§æ¨¡å—

## è®¸å¯è¯
æœ¬é¡¹ç›®é‡‡ç”¨ MIT License å¼€æºåè®®ï¼Œè¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## è´¡çŒ®æŒ‡å—
1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

## æŠ€æœ¯æ”¯æŒ
- æäº¤ [Issue](../../issues) æŠ¥å‘Š Bug æˆ–è¯·æ±‚æ–°åŠŸèƒ½
- æŸ¥çœ‹ [Wiki](../../wiki) è·å–è¯¦ç»†æ–‡æ¡£
- å‚ä¸ [Discussions](../../discussions) æŠ€æœ¯è®¨è®º

---

**AsioCoroutine** - è®©å¼‚æ­¥ç½‘ç»œç¼–ç¨‹æ›´ç®€å•ã€æ›´é«˜æ•ˆï¼ ğŸš€
